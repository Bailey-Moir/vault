/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var M=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var H=Object.getOwnPropertyNames;var K=Object.prototype.hasOwnProperty;var q=(a,s)=>{for(var t in s)M(a,t,{get:s[t],enumerable:!0})},G=(a,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of H(s))!K.call(a,i)&&i!==t&&M(a,i,{get:()=>s[i],enumerable:!(e=U(s,i))||e.enumerable});return a};var Q=a=>G(M({},"__esModule",{value:!0}),a);var j={};q(j,{default:()=>V});module.exports=Q(j);var y=require("obsidian");var v=class{},u=class extends v{constructor(t){super();this.unit=t,this.numberFormat=Intl.NumberFormat("en-US",{style:"decimal"})}format(t){return`${this.numberFormat.format(t)} ${this.unit}`}},N=class extends v{constructor(t){super();this.numberFormat=t}format(t){let[e,i]=this.scale(t);return`${this.numberFormat.format(e)} ${i}`}},f=class extends N{constructor(){super(Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}))}scale(s){let t=["bytes","KB","MB","GB","TB","PB"];for(;s>1024&&t.length>0;)s=s/1024,t.shift();return[s,t[0]]}};var _=require("obsidian"),c=class extends _.Events{constructor(){super(...arguments);this.files=0;this.notes=0;this.attachments=0;this.size=0;this.links=0;this.words=0;this.quality=1e-5;this.tags=0}reset(){this.files=0,this.notes=0,this.attachments=0,this.size=0,this.links=0,this.words=0,this.quality=1e-5,this.tags=0}dec(t){this.files-=(t==null?void 0:t.files)||0,this.notes-=(t==null?void 0:t.notes)||0,this.attachments-=(t==null?void 0:t.attachments)||0,this.size-=(t==null?void 0:t.size)||0,this.links-=(t==null?void 0:t.links)||0,this.words-=(t==null?void 0:t.words)||0,this.quality=this.links/this.notes||1e-5,this.tags-=(t==null?void 0:t.tags)||0,this.trigger("updated")}inc(t){this.files+=(t==null?void 0:t.files)||0,this.notes+=(t==null?void 0:t.notes)||0,this.attachments+=(t==null?void 0:t.attachments)||0,this.size+=(t==null?void 0:t.size)||0,this.links+=(t==null?void 0:t.links)||0,this.words+=(t==null?void 0:t.words)||0,this.quality=this.links/this.notes||1e-5,this.tags+=(t==null?void 0:t.tags)||0,this.trigger("updated")}on(t,e,i){return super.on("updated",e,i)}};var g=require("obsidian");var E=class{tokenize(s){return[]}},o=class{isNonWord(s){return o.NON_WORDS.test(s)}isNumber(s){return o.NUMBER.test(s)}isCodeBlockHeader(s){return o.CODE_BLOCK_HEADER.test(s)}stripHighlights(s){let t=o.STRIP_HIGHLIGHTS.exec(s);return t?t[2]:s}stripFormatting(s){let t=o.STRIP_FORMATTING.exec(s);return t?t[2]:s}stripPunctuation(s){let t=o.STRIP_PUNCTUATION.exec(s);return t?t[2]:s}stripWikiLinks(s){let t=o.STRIP_WIKI_LINKS.exec(s);return t?t[2]:s}stripUrls(s){return s.replace(o.STRIP_URLS,"$1")}stripAll(s){return[this.stripHighlights,this.stripFormatting,this.stripPunctuation,this.stripWikiLinks,this.stripUrls].reduce((t,e)=>e.call(this,t),s)}tokenize(s){return s.trim()===""?[]:s.split(o.WORD_BOUNDARY).filter(t=>!this.isNonWord(t)).filter(t=>!this.isNumber(t)).filter(t=>!this.isCodeBlockHeader(t)).map(t=>this.stripAll(t)).filter(t=>t.length>0)}},l=o;l.NON_WORDS=/^[^\wа-яА-ЯёЁ]+$/,l.NUMBER=/^\d+(\.\d+)?$/,l.CODE_BLOCK_HEADER=/^```\w+$/,l.STRIP_HIGHLIGHTS=/^(==)?(.*?)(==)?$/,l.STRIP_FORMATTING=/^(_+|\*+)?(.*?)(_+|\*+)?$/,l.STRIP_PUNCTUATION=/^(`|\.|:|"|,|!|\?)?(.*?)(`|\.|:|"|,|!|\?)?$/,l.STRIP_WIKI_LINKS=/^(\[\[)?(.*?)(\]\])?$/,l.STRIP_URLS=/\[.*?\]\((.*?)\)/g,l.WORD_BOUNDARY=/[ \n\r\t\"\|,\(\)\[\]/]+/;var r=new E,d=new l;var b=class{constructor(s){this.data=new Map;this.backlog=new Array;this.vaultMetrics=new c;this.owner=s}setVault(s){return this.vault=s,this}setExcludeDirectories(s){return this.excludeDirectories=s,this}setMetadataCache(s){return this.metadataCache=s,this}setFullVaultMetrics(s){return this.vaultMetrics=s,this}start(){var s;return this.owner.registerEvent(this.vault.on("create",t=>{this.onfilecreated(t)})),this.owner.registerEvent(this.vault.on("modify",t=>{this.onfilemodified(t)})),this.owner.registerEvent(this.vault.on("delete",t=>{this.onfiledeleted(t)})),this.owner.registerEvent(this.vault.on("rename",(t,e)=>{this.onfilerenamed(t,e)})),this.owner.registerEvent(this.metadataCache.on("resolve",t=>{this.onfilemodified(t)})),this.owner.registerEvent(this.metadataCache.on("changed",t=>{this.onfilemodified(t)})),this.data.clear(),this.backlog=new Array,(s=this.vaultMetrics)==null||s.reset(),this.vault.getFiles().forEach(t=>{t instanceof g.TFolder||this.push(t)}),this.owner.registerInterval(+setInterval(()=>{this.processBacklog()},2e3)),this.setExcludeDirectories(this.excludeDirectories),this}push(s){if(s instanceof g.TFolder)return;let t=s instanceof g.TFile?s.path:s;this.backlog.contains(t)||this.backlog.push(t)}async processBacklog(){for(;this.backlog.length>0;){let s=this.backlog.shift();if(s==null||s.split("/").some(e=>this.excludeDirectories.includes(e)))break;let t=this.vault.getAbstractFileByPath(s);if(t instanceof g.TFile)try{let e=await this.collect(t);e!=null&&this.update(s,e)}catch(e){console.log(`error processing ${s}: ${e}`)}}}async onfilecreated(s){this.push(s)}async onfilemodified(s){this.push(s)}async onfiledeleted(s){this.push(s)}async onfilerenamed(s,t){this.push(s),this.push(t)}getFileType(s){var t;return((t=s.extension)==null?void 0:t.toLowerCase())==="md"?1:2}async collect(s){let t;try{t=this.metadataCache.getFileCache(s)}catch(e){t=null}if(t===null)return null;switch(this.getFileType(s)){case 1:return new F(this.vault).collect(s,t);case 2:return new x().collect(s,t)}}update(s,t){var i,m,w;let e=s instanceof g.TFile?s.path:s;(m=this.vaultMetrics)==null||m.dec((i=this.data.get(e))!=null?i:new c),t==null?this.data.delete(e):this.data.set(e,t),(w=this.vaultMetrics)==null||w.inc(t)}},C=class{constructor(s){this.vault=s}async collect(s,t){var m,w,k,R;let e=new c;e.files=1,e.notes=1,e.attachments=0,e.size=(m=s.stat)==null?void 0:m.size,e.links=((w=t==null?void 0:t.links)==null?void 0:w.length)||0;let i=await this.vault.cachedRead(s).then(I=>{var B;return(B=t.sections)==null?void 0:B.map(p=>{var P,L,O,z;let T=p.type,$=(L=(P=p.position)==null?void 0:P.start)==null?void 0:L.offset,W=(z=(O=p.position)==null?void 0:O.end)==null?void 0:z.offset,D=C.TOKENIZERS.get(T);return D?D.tokenize(I.substring($,W)).length:(console.log(`${s.path}: no tokenizer, section.type=${p.type}`),0)}).reduce((p,T)=>p+T,0)}).catch(I=>(console.log(`${s.path} ${I}`),0));return e.words=i!=null?i:0,e.quality=e.notes!==0?e.links/e.notes:0,e.tags=(R=(k=t==null?void 0:t.tags)==null?void 0:k.length)!=null?R:0,e}},F=C;F.TOKENIZERS=new Map([["paragraph",d],["heading",d],["list",d],["table",r],["yaml",r],["code",r],["blockquote",d],["math",r],["thematicBreak",r],["html",r],["text",r],["element",r],["footnoteDefinition",r],["definition",r],["callout",d],["comment",r]]);var x=class{async collect(s,t){var i;let e=new c;return e.files=1,e.notes=0,e.attachments=1,e.size=(i=s.stat)==null?void 0:i.size,e.links=0,e.words=0,e.quality=0,e.tags=0,e}};var n=require("obsidian"),S=class extends n.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new n.Setting(t).setName("Exclude directories").setDesc("Exclude directories from statistics").addText(e=>{e.setValue(this.plugin.settings.excludeDirectories).onChange(async i=>{this.plugin.settings.excludeDirectories=i,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Show individual items").setDesc("Whether to show multiple items at once or cycle them with a click").addToggle(e=>{e.setValue(this.plugin.settings.displayIndividualItems).onChange(async i=>{this.plugin.settings.displayIndividualItems=i,this.display(),await this.plugin.saveSettings()})}),this.plugin.settings.displayIndividualItems&&(new n.Setting(t).setName("Show notes").addToggle(e=>{e.setValue(this.plugin.settings.showNotes).onChange(async i=>{this.plugin.settings.showNotes=i,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Show attachments").addToggle(e=>{e.setValue(this.plugin.settings.showAttachments).onChange(async i=>{this.plugin.settings.showAttachments=i,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Show files").addToggle(e=>{e.setValue(this.plugin.settings.showFiles).onChange(async i=>{this.plugin.settings.showFiles=i,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Show links").addToggle(e=>{e.setValue(this.plugin.settings.showLinks).onChange(async i=>{this.plugin.settings.showLinks=i,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Show words").addToggle(e=>{e.setValue(this.plugin.settings.showWords).onChange(async i=>{this.plugin.settings.showWords=i,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Show size").addToggle(e=>{e.setValue(this.plugin.settings.showSize).onChange(async i=>{this.plugin.settings.showSize=i,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Show tags").addToggle(e=>{e.setValue(this.plugin.settings.showTags).onChange(async i=>{this.plugin.settings.showTags=i,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Show quality").addToggle(e=>{e.setValue(this.plugin.settings.showQuality).onChange(async i=>{this.plugin.settings.showQuality=i,await this.plugin.saveSettings()})}))}};var Z={excludeDirectories:"",displayIndividualItems:!1,showNotes:!1,showAttachments:!1,showFiles:!1,showLinks:!1,showWords:!1,showSize:!1,showQuality:!1,showTags:!1},V=class extends y.Plugin{constructor(){super(...arguments);this.statusBarItem=null}async onload(){console.log("Loading vault-statistics Plugin"),await this.loadSettings(),this.vaultMetrics=new c,this.vaultMetricsCollector=new b(this).setVault(this.app.vault).setMetadataCache(this.app.metadataCache).setFullVaultMetrics(this.vaultMetrics).setExcludeDirectories(this.settings.excludeDirectories).start(),this.statusBarItem=new A(this,this.addStatusBarItem()).setFullVaultMetrics(this.vaultMetrics),this.addSettingTab(new S(this.app,this))}async loadSettings(){this.settings=Object.assign({},Z,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.statusBarItem&&this.statusBarItem.refresh()}},h=class{constructor(s){this.containerElementsForVaultFullStatistics=s.createSpan({cls:["obsidian-vault-full-statistics--item"]}),this.setActive(!1)}setStatisticName(s){return this.containerElementsForVaultFullStatistics.addClass(`obsidian-vault-full-statistics--item-${s}`),this}setFormatter(s){return this.formatter=s,this}setActive(s){return this.containerElementsForVaultFullStatistics.removeClass("obsidian-vault-full-statistics--item--active"),this.containerElementsForVaultFullStatistics.removeClass("obsidian-vault-full-statistics--item--inactive"),s?this.containerElementsForVaultFullStatistics.addClass("obsidian-vault-full-statistics--item--active"):this.containerElementsForVaultFullStatistics.addClass("obsidian-vault-full-statistics--item--inactive"),this}refresh(s){this.containerElementsForVaultFullStatistics.setText(this.formatter(s))}getText(){return this.containerElementsForVaultFullStatistics.getText()}},A=class{constructor(s,t){this.displayedStatisticIndex=0;this.statisticViews=[];this.refreshSoon=(0,y.debounce)(()=>{this.refresh()},2e3,!1);this.owner=s,this.statusBarItem=t,this.statisticViews.push(new h(this.statusBarItem).setStatisticName("notes").setFormatter(e=>new u("notes").format(e.notes))),this.statisticViews.push(new h(this.statusBarItem).setStatisticName("attachments").setFormatter(e=>new u("attachments").format(e.attachments))),this.statisticViews.push(new h(this.statusBarItem).setStatisticName("files").setFormatter(e=>new u("files").format(e.files))),this.statisticViews.push(new h(this.statusBarItem).setStatisticName("links").setFormatter(e=>new u("links").format(e.links))),this.statisticViews.push(new h(this.statusBarItem).setStatisticName("words").setFormatter(e=>new u("words").format(e.words))),this.statisticViews.push(new h(this.statusBarItem).setStatisticName("size").setFormatter(e=>new f().format(e.size))),this.statisticViews.push(new h(this.statusBarItem).setStatisticName("tags").setFormatter(e=>new u("tags").format(e.tags))),this.statisticViews.push(new h(this.statusBarItem).setStatisticName("QoV").setFormatter(e=>new u("QoV").format(e.quality))),this.statusBarItem.onClickEvent(()=>{this.onclick()})}setFullVaultMetrics(s){var t;return this.vaultMetrics=s,this.owner.registerEvent((t=this.vaultMetrics)==null?void 0:t.on("updated",this.refreshSoon)),this.refreshSoon(),this}refresh(){this.owner.settings.displayIndividualItems?(this.statisticViews[0].setActive(this.owner.settings.showNotes).refresh(this.vaultMetrics),this.statisticViews[1].setActive(this.owner.settings.showAttachments).refresh(this.vaultMetrics),this.statisticViews[2].setActive(this.owner.settings.showFiles).refresh(this.vaultMetrics),this.statisticViews[3].setActive(this.owner.settings.showLinks).refresh(this.vaultMetrics),this.statisticViews[4].setActive(this.owner.settings.showWords).refresh(this.vaultMetrics),this.statisticViews[5].setActive(this.owner.settings.showSize).refresh(this.vaultMetrics),this.statisticViews[6].setActive(this.owner.settings.showTags).refresh(this.vaultMetrics),this.statisticViews[7].setActive(this.owner.settings.showQuality).refresh(this.vaultMetrics)):this.statisticViews.forEach((s,t)=>{s.setActive(this.displayedStatisticIndex==t).refresh(this.vaultMetrics)}),this.statusBarItem.title=this.statisticViews.map(s=>s.getText()).join(`
`)}onclick(){this.owner.settings.displayIndividualItems||(this.displayedStatisticIndex=(this.displayedStatisticIndex+1)%this.statisticViews.length),this.refresh()}};

/* nosourcemap */